<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
			<meta name="viewport" content="width=device-width, initial-scale=1.0">
				<title>Clock In/Out Tracker</title>
				<style>
					body {
						font-family: Arial, sans-serif;
						margin: 50px;
					}
				.container {
					max-width: 300px;
					margin: auto;
					text-align: center;
				}
				input[type="text"], input[type="datetime-local"], button {
					padding: 10px;
					margin: 5px;
					width: 100%;
				}
				#timer {
					font-size: 20px;
					margin: 10px 0;
				}
				</style>
	</head>
	<body>
		<div class="container">
			<h1>Clock In/Out</h1>
			<input type="text" id="userInput" placeholder="Enter your name">
				<input type="text" id="assignmentInput" placeholder="Enter your assignment">
					<input type="datetime-local" id="dateTimeInput" placeholder="Select Date and Time">
						<button id="clockInButton" onclick="clockIn()">Clock In</button>
						<button id="clockOutButton" onclick="clockOut()" disabled>Clock Out</button>
						<div id="timer">00:00</div>
						
						<h2>Get Records</h2>
						<input type="datetime-local" id="startDate" placeholder="Start Date">
							<input type="datetime-local" id="endDate" placeholder="End Date">
								<button onclick="getRecords()">Get Records</button>
								<button onclick="getLastWeekRecords()">Last Week</button>
								<button onclick="getLastMonthRecords()">Last Month</button>
								</div>
		
		<script>
			let timerInterval;
			let startTime;
			
			function formatDateTimeForInput(date) {
				const year = date.getFullYear();
				const month = String(date.getMonth() + 1).padStart(2, '0');
				const day = String(date.getDate()).padStart(2, '0');
				const hours = String(date.getHours()).padStart(2, '0');
				const minutes = String(date.getMinutes()).padStart(2, '0');
				return `${year}-${month}-${day}T${hours}:${minutes}`;
			}
		
		function setDefaultDateTime() {
			const now = new Date();
			const localDateTime = formatDateTimeForInput(now);
			document.getElementById('dateTimeInput').value = localDateTime;
			document.getElementById('startDate').value = localDateTime;
			document.getElementById('endDate').value = localDateTime;
		}
		
		async function clockIn() {
			const name = document.getElementById('userInput').value;
			const assignment = document.getElementById('assignmentInput').value;
			const dateTime = document.getElementById('dateTimeInput').value;
			if (name && dateTime) {
				const response = await fetch('/clock-in', {
											 method: 'POST',
											 headers: { 'Content-Type': 'application/json' },
											 body: JSON.stringify({ name: name, time: dateTime, assignment: assignment })
											 });
											 const message = await response.text();
											 alert(message);
											 
											 if (response.ok) {
												 startTime = new Date();
												 startTimer();
												 document.getElementById('clockInButton').disabled = true;
												 document.getElementById('clockOutButton').disabled = false;
											 }
			} else {
				alert('Please enter your name and select a date/time.');
			}
		}
		
		async function clockOut() {
			const name = document.getElementById('userInput').value;
			const dateTime = document.getElementById('dateTimeInput').value;
			if (name && dateTime) {
				const response = await fetch('/clock-out', {
											 method: 'POST',
											 headers: { 'Content-Type': 'application/json' },
											 body: JSON.stringify({ name: name, time: dateTime })
											 });
											 const message = await response.text();
											 alert(message);
											 
											 if (response.ok) {
												 stopTimer();
												 document.getElementById('clockInButton').disabled = false;
												 document.getElementById('clockOutButton').disabled = true;
											 }
			} else {
				alert('Please enter your name and select a date/time.');
			}
		}
		
		function startTimer() {
			const timerDisplay = document.getElementById('timer');
			const updateTimer = () => {
				const now = new Date();
				const elapsed = new Date(now - startTime);
				const hours = String(elapsed.getUTCHours()).padStart(2, '0');
				const minutes = String(elapsed.getUTCMinutes()).padStart(2, '0');
				timerDisplay.textContent = `${hours}:${minutes}`;
			};
			timerInterval = setInterval(updateTimer, 1000);
			updateTimer();
		}
		
		function stopTimer() {
			clearInterval(timerInterval);
			document.getElementById('timer').textContent = '00:00';
		}
		
			// Set default date and time when the page loads
			window.onload = setDefaultDateTime;
			
			async function getRecords() {
				const start = document.getElementById('startDate').value;
				const end = document.getElementById('endDate').value;
				const name = document.getElementById('userInput').value;
				const response = await fetch(`/records?start=${start}&end=${end}&name=${name}`);
				if (response.ok) {
					const data = await response.json();
					console.log(data);
						// Display or process the data
				} else {
					alert(await response.text());
				}
			}
		
		function getLastWeekRecords() {
			const now = new Date();
			const end = formatDateTimeForInput(now);
			now.setDate(now.getDate() - 7);
			const start = formatDateTimeForInput(now);
			document.getElementById('startDate').value = start;
			document.getElementById('endDate').value = end;
			getRecords();
		}
		
		function getLastMonthRecords() {
			const now = new Date();
			const end = formatDateTimeForInput(now);
			now.setMonth(now.getMonth() - 1);
			const start = formatDateTimeForInput(now);
			document.getElementById('startDate').value = start;
			document.getElementById('endDate').value = end;
			getRecords();
		}
		</script>
	</body>
</html>

